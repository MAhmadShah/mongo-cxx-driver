<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<meta name="keyword" content="">
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

    <link rel="shortcut icon" href="https://mongocxx.org/img/favicon.png">

    <title>Working with BSON</title>

    <link rel="stylesheet" href="https://mongocxx.org/lib/bootstrap.css" type="text/css" />
<link rel="stylesheet" href="https://mongocxx.org/lib/font-awesome/css/font-awesome.min.css" type="text/css" />
<link rel="stylesheet" href="https://mongocxx.org/css/mongodb-docs.css" type="text/css" />
<link rel="stylesheet" href="https://mongocxx.org/css/overrides.css" type="text/css" />
<link rel="stylesheet" href="https://mongocxx.org/lib/highlight/styles/idea.css" />

  </head>

  <body>
  
  <section id="container" class="">
      
      <header id="header-db" class="row" role="navigation">
  <div class="header-content">
    <div class="toggle-nav pull-left">
        <i class="fa fa-bars"></i>
        <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"></div>
    </div>
    
    <div class="logo pull-left">
      <a href="https://mongocxx.org">
        <img src="https://mongocxx.org/img/logo-mongodb-header.png",
             alt="MongoDB C++ driver" />
      </a>
    </div>
    
    <div>
<div class="nav-items pull-right">
  <div id="search">
<form method="get" action="//www.google.com/search" target="_blank">
    <input type="text" name="searchQuery" size="20" value="" autocomplete="off" placeholder="Search">
    <input type="hidden" name="site" value="https://mongocxx.org">
    <input type="hidden" name="q" value="">
    <label for="searchQuery"><i class="fa fa-search fa-1"></i></label>
</form>
</div>

</div>
</div>

  </div>
</header>

      

      
<aside id="sidebar" class="sidebar">
    <div class="ssidebar nav-collapse">
      <div class="ssidebarwrapper">
        <h3>
          <a class="index-link" href="https://mongocxx.org">MongoDB C&#43;&#43; Driver Manual</a>
        </h3>

        
        <ul class="sidebar-menu">
          
          
          
          
          
          
          
          
          
          
          
          

          
          
            
            









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
    
      
    
  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  
  
  
  
  
  
  
  

  
    
    
    
  
  


        
      
    
      
      
        
      
    
      
      
    
    
  


          
            
            









  
    
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
    
  


          
            
            









  


          
            
            









  


          
            
            









  


          
            
            









  


          
            
            









  
    
    
      
      
    
      
      
    
      
      
    
    
  


          

          

          
            
            













  




<li class="toctree-l1  current">
  <a href="/mongocxx-v3/" class="">
      <i class='fa fa-arrow-right'></i>
      <span>mongocxx (v3)</span>
      <span class="menu-arrow fa fa-angle-down"></span>
  </a>
    <ul  class="current">
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongocxx-v3/polyfill-selection/">
        
        Choosing a C&#43;&#43;17 Polyfill
    </a>
  </li>


        
        
        
        
        
















<li class="toctree-l2 ">
  <a href="/mongocxx-v3/installation/" class="">
      
      <span>Installing the mongocxx driver</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongocxx-v3/installation/windows/">
        
        Windows
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongocxx-v3/installation/macos/">
        
        macOS
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongocxx-v3/installation/linux/">
        
        Linux
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongocxx-v3/installation/advanced/">
        
        Advanced Configuration and Installation Options
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongocxx-v3/configuration/">
        
        Configuring the mongocxx driver
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongocxx-v3/client-side-encryption/">
        
        Client-Side Field Level Encryption with mongocxx
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongocxx-v3/tutorial/">
        
        Tutorial for mongocxx
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongocxx-v3/thread-safety/">
        
        Thread and fork safety
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongocxx-v3/connection-pools/">
        
        Connection pools
    </a>
  </li>


        
        
        
        
        













  




    <li class="toctree-l2">
    <a href="/mongocxx-v3/working-with-bson/">
        
        Working with BSON
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongocxx-v3/api-abi-versioning/">
        
        API and ABI versioning
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongocxx-v3/">
        
        The mongocxx (v3) driver
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            
















<li class="toctree-l1 ">
  <a href="/legacy-v1/" class="">
      <i class='fa fa-arrow-right'></i>
      <span>legacy (v1)</span>
      <span class="menu-arrow fa fa-angle-right"></span>
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l2">
    <a href="/legacy-v1/installation/">
        
        Installing the legacy driver
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/legacy-v1/configuration/">
        
        Configuring the legacy driver
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/legacy-v1/tutorial/">
        
        Legacy driver tutorial
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/legacy-v1/working-with-bson/">
        
        Working with BSON
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/legacy-v1/breaking-changes/">
        
        Breaking changes from 26compat
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/legacy-v1/">
        
        The Legacy C&#43;&#43; Driver
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="https://mongocxx.org/api/current">
        <i class='fa fa-file-text-o'></i>
        API Documentation
    </a>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="/getting-help/">
        <i class='fa fa-question'></i>
        Getting help
    </a>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="/reporting-bugs/">
        <i class='fa fa-bug'></i>
        Reporting Bugs
    </a>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="https://github.com/mongodb/mongo-cxx-driver/">
        <i class='fa fa-github'></i>
        Source Code
    </a>
  </li>


          
            
            
















<li class="toctree-l1 ">
  <a href="/contributing/" class="">
      <i class='fa fa-pencil'></i>
      <span>Contributing</span>
      <span class="menu-arrow fa fa-angle-right"></span>
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l2">
    <a href="/contributing/testing-mongocxx/">
        
        Testing the mongocxx driver
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/contributing/testing-legacy/">
        
        Testing the legacy driver
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/contributing/">
        
        Contribution Guidelines
    </a>
  </li>


        
        
    </ul>
  </li>


          
        </ul>
        
    </div>
  </div>
  

</aside>



      
      <section id="main-content" class="content">
          <section class="main-column pull-left">
            <div class="document">
              <div class="documentwrapper">
                <div class="bodywrapper">
                  <div class="body">


   
<a class="edit-link" href="https://github.com/mongodb/mongo-cxx-driver/blob/master/docs/content/mongocxx-v3/working-with-bson.md" target="_blank" title="Edit mongocxx-v3/working-with-bson.md on GitHub"><i class="fa fa-pencil-square-o"></i></a>










<div class="bc">
<ul>
  
  
  
  
  
  <li><a href="/mongocxx-v3/">mongocxx (v3)</a> <i class="fa fa-angle-right"></i></li>
  <li>Working with BSON</li>
</ul>
</div>


<h1>Working with BSON</h1>
<p>The mongocxx driver ships with a new library, bsoncxx.  This article will
go over some of the different types in this library, and how and when to
use each.  For more information and example code, see our
<a href="https://github.com/mongodb/mongo-cxx-driver/tree/master/examples/bsoncxx">examples</a>.</p>
<ol>
<li><a href="#builders">Document Builders</a><!-- raw HTML omitted --></li>
<li><a href="#value">Owning BSON Documents (values)</a><!-- raw HTML omitted --></li>
<li><a href="#view">Non-owning BSON Documents (views)</a><!-- raw HTML omitted --></li>
<li><a href="#view_or_value">Optionally-owning BSON Documents(view_or_value)</a><!-- raw HTML omitted --></li>
<li><a href="#lifetime">BSON Document Lifetime</a><!-- raw HTML omitted --></li>
<li><a href="#print">Printing BSON Documents</a><!-- raw HTML omitted --></li>
<li><a href="#fields">Getting Fields out of BSON Documents</a><!-- raw HTML omitted --></li>
</ol>
<h2 id="builders">Document Builders</h2>
<p>The bsoncxx library offers four interfaces for building BSON: one-off
functions, a basic builder, a list builder and a stream-based builder.</p>
<p><a href="https://github.com/mongodb/mongo-cxx-driver/blob/master/src/bsoncxx/include/bsoncxx/v_noabi/bsoncxx/builder/basic/document.hpp"><code>bsoncxx::builder::basic::document</code></a><!-- raw HTML omitted -->
<a href="https://github.com/mongodb/mongo-cxx-driver/blob/master/src/bsoncxx/include/bsoncxx/v_noabi/bsoncxx/builder/stream/document.hpp"><code>bsoncxx::builder::stream::document</code></a></p>
<p>The various methods of creating BSON documents and arrays are all
equivalent. All interfaces will provide the same results, the choice of
which to use is entirely aesthetic.</p>
<h2 id="list">List builder</h2>
<p>The simplest way to create a BSON document or array is to use the JSON-like
list builder:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">// { &#34;hello&#34;: &#34;world&#34; }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>bsoncxx<span style="color:#f92672">::</span>builder<span style="color:#f92672">::</span>list list_builder <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;hello&#34;</span>, <span style="color:#e6db74">&#34;world&#34;</span>};
</span></span><span style="display:flex;"><span>bsoncxx<span style="color:#f92672">::</span>document<span style="color:#f92672">::</span>view document <span style="color:#f92672">=</span> list_builder.view().get_document();
</span></span></code></pre></div><p>More advanced uses of the list builder are shown in <a href="https://github.com/mongodb/mongo-cxx-driver/blob/master/examples/bsoncxx/builder_list.cpp">this
example</a>.</p>
<h2 id="one-off">&ldquo;One-off&rdquo; builder functions</h2>
<p>The &ldquo;One-off&rdquo; builder creates documents and arrays in a single call.
These can be used when no additional logic (such as conditionals or loops)
needs to be used to create the object:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> bsoncxx<span style="color:#f92672">::</span>builder<span style="color:#f92672">::</span>basic<span style="color:#f92672">::</span>kvp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// { &#34;hello&#34;: &#34;world&#34; }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>bsoncxx<span style="color:#f92672">::</span>document<span style="color:#f92672">::</span>value document <span style="color:#f92672">=</span> bsoncxx<span style="color:#f92672">::</span>builder<span style="color:#f92672">::</span>basic<span style="color:#f92672">::</span>make_document(kvp(<span style="color:#e6db74">&#34;hello&#34;</span>, <span style="color:#e6db74">&#34;world&#34;</span>));
</span></span></code></pre></div><h2 id="basic-builder">Basic builder</h2>
<pre tabindex="0"><code>using bsoncxx::builder::basic::kvp;

// { &#34;hello&#34; : &#34;world&#34; }
bsoncxx::builder::basic::document basic_builder{};
basic_builder.append(kvp(&#34;hello&#34;, &#34;world&#34;));
bsoncxx::document::value document = basic_builder.extract();
</code></pre><p>More advanced uses of the basic builder are shown in <a href="https://github.com/mongodb/mongo-cxx-driver/blob/master/examples/bsoncxx/builder_basic.cpp">this
example</a>.</p>
<h2 id="stream-builder">Stream builder</h2>
<pre tabindex="0"><code>// { &#34;hello&#34; : &#34;world&#34; }

using bsoncxx::builder::stream;
bsoncxx::document::value document = stream::document{} &lt;&lt; &#34;hello&#34; &lt;&lt; &#34;world&#34; &lt;&lt; stream::finalize;
</code></pre><p>More advanced uses of the stream builder are shown in <a href="https://github.com/mongodb/mongo-cxx-driver/blob/master/examples/bsoncxx/builder_stream.cpp">this
example</a>.</p>
<p><strong>NOTE</strong>: In order to properly append each new value, a stream builder
needs to keep track of the state of the current document, including the
nesting level and the type of the most recent value appended to the
builder. The initial stream builder must <em>not</em> be reused after this state
changes, which means that intermediate values must be stored in new
variables if a document is being built with the stream builder across
multiple statements. Because doing this properly is difficult and the
compiler error messages can be confusing, using the stream builder is
discouraged. We recommend instead using the basic builder or the
<a href="#one-off">one-off builder functions</a>.</p>
<p><strong>Building arrays in loops</strong></p>
<p>Sometimes it&rsquo;s necessary to build an array using a loop. With the basic
builder, a top-level array can be built by simply calling <code>append</code> inside
a loop:</p>
<pre tabindex="0"><code>// [ 1, 2, 3 ]

const auto elements = {1, 2, 3};
auto array_builder = bsoncxx::builder::basic::array{};

for (const auto&amp; element : elements) {
    array_builder.append(element);
}
</code></pre><p>To build a subarray in a loop, pass a lambda to <code>append</code> (or as the second
argument of <code>kvp</code> if the subarray is contained by a document rather than
an array):</p>
<pre tabindex="0"><code>// { &#34;foo&#34; : [ 1, 2, 3 ] }

using bsoncxx::builder::basic::kvp;
using bsoncxx::builder::basic::sub_array;

const auto elements = {1, 2, 3};
auto doc = bsoncxx::builder::basic::document{};
doc.append(kvp(&#34;foo&#34;, [&amp;elements](sub_array child) {
    for (const auto&amp; element : elements) {
        child.append(element);
    }
}));
</code></pre><p>When building an array with the stream builder, it&rsquo;s important to be aware
that the return type of using the <code>&lt;&lt;</code> operator on a stream builder is not
uniform. To build an array in a loop properly, intermediate values
returned by the stream builder should be stored in variables when the type
changes. One attempt to build an array from a stream builder using a loop
might look like the following:</p>
<pre tabindex="0"><code>// { &#34;subdocs&#34; : [ { &#34;key&#34; : 1 }, { &#34;key&#34; : 2 }, { &#34;key&#34; : 3 } ], &#34;another_key&#34; : 42 }
using namespace bsoncxx;

builder::stream::document builder{};

auto in_array = builder &lt;&lt; &#34;subdocs&#34; &lt;&lt; builder::stream::open_array;
for (auto&amp;&amp; e : {1, 2, 3}) {
    in_array = in_array &lt;&lt; builder::stream::open_document &lt;&lt; &#34;key&#34; &lt;&lt; e
                        &lt;&lt; builder::stream::close_document;
}
auto after_array = in_array &lt;&lt; builder::stream::close_array;

after_array &lt;&lt; &#34;another_key&#34; &lt;&lt; 42;

document::value doc = after_array &lt;&lt; builder::stream::finalize;

std::cout &lt;&lt; to_json(doc) &lt;&lt; std::endl;
</code></pre><p>Note that the result of any stream operation should be captured, so if you want
to split the single statement within the for loop above into multiple
statements, you must capture each intermediate result. Additionally, the last
statement within the loop body should assign its result back to the in_array
object, so that the loop restarts in a consistent state:</p>
<pre tabindex="0"><code>for (auto &amp;&amp; e : {1, 2, 3}) {
    auto open_state = in_array &lt;&lt; builder::stream::open_document;
    auto temp_state = open_state &lt;&lt; &#34;key&#34; &lt;&lt; e;
    in_array = temp_state &lt;&lt; builder::stream::close_document;
}
</code></pre><h3 id="a-namevalueowning-bson-documents-valuesa"><!-- raw HTML omitted -->Owning BSON Documents (values)<!-- raw HTML omitted --></h3>
<p><a href="https://github.com/mongodb/mongo-cxx-driver/blob/master/src/bsoncxx/include/bsoncxx/v_noabi/bsoncxx/document/value.hpp"><code>bsoncxx::document::value</code></a></p>
<p>This type represents an actual BSON document, one that owns its buffer of
data.  These documents can be constructed from a builder by calling
<code>extract()</code>:</p>
<pre tabindex="0"><code>bsoncxx::document::value basic_doc{basic_builder.extract()};
bsoncxx::document::value stream_doc{stream_builder.extract()};
</code></pre><p>Note that after calling <code>extract()</code> the builder is in a moved-from state,
and should not be used.</p>
<p>It&rsquo;s possible to create a <code>bsoncxx::document::value</code> in a single line using
the stream builder interface and the <code>finalize</code> token. <code>finalize</code> returns a
<code>document::value</code> from a temporary stream builder:</p>
<pre tabindex="0"><code>// { &#34;finalize&#34; : &#34;is nifty&#34; }
bsoncxx::document::value one_line = bsoncxx::builder::stream::document{} &lt;&lt; &#34;finalize&#34; &lt;&lt; &#34;is nifty&#34; &lt;&lt; bsoncxx::builder::stream::finalize;
</code></pre><h3 id="a-nameviewnon-owning-bson-documents-viewsa"><!-- raw HTML omitted -->Non-owning BSON Documents (views)<!-- raw HTML omitted --></h3>
<p><a href="https://github.com/mongodb/mongo-cxx-driver/blob/master/src/bsoncxx/include/bsoncxx/v_noabi/bsoncxx/document/view.hpp"><code>bsoncxx::document::view</code></a></p>
<p>This type is a view into an owning <code>bsoncxx::document::value</code>.</p>
<pre tabindex="0"><code>bsoncxx::document::view document_view{document_value.view()};
</code></pre><p>A <code>document::value</code> also implicitly converts to a <code>document::view</code>:</p>
<pre tabindex="0"><code>bsoncxx::document::view document_view{document_value};
</code></pre><p>In performance-critical code, passing views around is preferable to using
values because we can avoid excess copying. Also, passing a view of a
document allows us to use the document multiple times:</p>
<pre tabindex="0"><code>// { &#34;copies&#34; : { &#34;$gt&#34; : 100 } }
auto query_value = document{} &lt;&lt; &#34;copies&#34; &lt;&lt; open_document &lt;&lt; &#34;$gt&#34; &lt;&lt; 100 &lt;&lt; close_document &lt;&lt; finalize;

// Run the same query across different collections
auto collection1 = db[&#34;science_fiction&#34;];
auto cursor1 = collection1.find(query_value.view());

auto collection2 = db[&#34;cookbooks&#34;];
auto cursor2 = collection2.find(query_value.view());
</code></pre><h3 id="a-nameview_or_valueoptionally-owning-bson-documents-view_or_valuea"><!-- raw HTML omitted -->Optionally-owning BSON Documents (view_or_value)<!-- raw HTML omitted --></h3>
<p>Many driver methods take a document::view_or_value parameter, for example, <a href="https://github.com/mongodb/mongo-cxx-driver/blob/master/src/mongocxx/include/mongocxx/v_noabi/mongocxx/database.hpp#L144-L153"><code>run_command</code></a>:</p>
<pre tabindex="0"><code>bsoncxx::document::value run_command(bsoncxx::document::view_or_value command);
</code></pre><p>Such methods can take either a <code>document::view</code> or a <code>document::value</code>. If
a <code>document::value</code> is passed in, it must be passed by r-value reference, so
ownership of the document is transferred to the method.</p>
<pre tabindex="0"><code>document::value ping = document{} &lt;&lt; &#34;ping&#34; &lt;&lt; 1 &lt;&lt; finalize;

// You can pass a document::view into run_command()
db.run_command(ping.view());

// Or you can move in a document::value
db.run_command(std::move(ping));
</code></pre><p>You shouldn&rsquo;t need to create view_or_value types directly in order to use
the driver.  They are offered as a convenience method to allow driver
methods to take documents in either an owning or non-owning way.  The
<code>view_or_value</code> type also helps mitigate some of the lifetime issues
discussed in the next section.</p>
<h3 id="a-namelifetimebson-document-lifetimea"><!-- raw HTML omitted -->BSON Document Lifetime<!-- raw HTML omitted --></h3>
<p>It is imperative that <code>document::value</code>s outlive any <code>document::view</code>s that
use them. If the underlying value gets cleaned up, the view will be left
with a dangling pointer.  Consider a method that returns a view of a
newly-created document:</p>
<pre tabindex="0"><code>bsoncxx::document::view make_a_dangling_view() {
   bsoncxx::builder::basic::document builder{};
   builder.append(kvp(&#34;hello&#34;, &#34;world&#34;));

   // This creates a document::value on the stack that will disappear when we return.
   bsoncxx::document::value stack_value{builder.extract()};

   // We&#39;re returning a view of the local value
   return stack_value.view(); // Bad!!
}
</code></pre><p>This method returns a dangling view that should not be used:</p>
<pre tabindex="0"><code>// This view contains a dangling pointer
bsoncxx::document::view dangling_view = make_a_dangling_view(); // Warning!!
</code></pre><p>Attempting to create a view off of a builder will similarly create a
dangerous view object, because the temporary value returned from
<code>extract()</code> isn&rsquo;t captured:</p>
<pre tabindex="0"><code>bsoncxx::builder::stream::document temp_builder{};
temp_builder &lt;&lt; &#34;oh&#34; &lt;&lt; &#34;no&#34;;
bsoncxx::document::view dangling_view = temp_builder.extract().view(); // Bad!!
</code></pre><h3 id="a-nameprintprinting-bson-documentsa"><!-- raw HTML omitted -->Printing BSON Documents<!-- raw HTML omitted --></h3>
<p><a href="https://github.com/mongodb/mongo-cxx-driver/blob/master/src/bsoncxx/include/bsoncxx/v_noabi/bsoncxx/json.hpp#L39-L55"><code>bsoncxx::to_json()</code></a></p>
<p>The bsoncxx library comes with a convenience method to convert BSON
documents to strings for easy inspection:</p>
<pre tabindex="0"><code>bsoncxx::document::value = document{} &lt;&lt; &#34;I am&#34; &lt;&lt; &#34;a BSON document&#34; &lt;&lt; finalize;
std::cout &lt;&lt; bsoncxx::to_json(doc.view()) &lt;&lt; std::endl;
</code></pre><p>There is an analogous method, <a href="https://github.com/mongodb/mongo-cxx-driver/blob/master/src/bsoncxx/include/bsoncxx/v_noabi/bsoncxx/json.hpp#L57-L67">from_json()</a>, to build document::values out of existing JSON strings.</p>
<h3 id="a-namefieldsgetting-fields-out-of-bson-documentsa"><!-- raw HTML omitted -->Getting Fields out of BSON Documents<!-- raw HTML omitted --></h3>
<p>The [ ] operator reaches into a BSON document to retrieve values:</p>
<pre tabindex="0"><code>// doc_view = { &#34;store&#34; : &#34;Key Foods&#34;, &#34;fruits&#34; : [ &#34;apple&#34;, &#34;banana&#34; ] }
auto store = doc_view[&#34;store&#34;];
auto first_fruit = doc_view[&#34;fruits&#34;][0];
</code></pre><p>This returns a <code>bsoncxx::document::element</code>, which holds the actual desired value:</p>
<pre tabindex="0"><code>document::element store_ele{doc_view[&#34;store&#34;]};
if (store_ele) {
    // this block will only execute if &#34;store&#34; was found in the document
    std::cout &lt;&lt; &#34;Examining inventory at &#34; &lt;&lt; to_json(store_ele.get_value()) &lt;&lt; std::endl;
}
</code></pre><p>This feature is shown in more detail in <a href="https://github.com/mongodb/mongo-cxx-driver/blob/master/examples/bsoncxx/getting_values.cpp">this example</a> and <a href="https://github.com/mongodb/mongo-cxx-driver/blob/master/examples/bsoncxx/view_and_value.cpp">this example</a>.</p>
<h3 id="bson-types">BSON Types</h3>
<p>The <a href="http://bsonspec.org/spec.html">BSON specification</a> provides a list
of supported types.  These are represented in C++ using the
<a href="https://mongocxx.org/api/current/classes.html#letter_B">b_xxx</a>
type wrappers.</p>
<p>Some BSON types don&rsquo;t necessarily have a native representation to wrap and
are implemented via special classes.</p>
<h4 id="decimal128">Decimal128</h4>
<p>The <code>bsoncxx::decimal128</code> class represents a 128-bit IEEE 754-2008 decimal
floating point value.  We expect users to convert these to and from
strings, but provide access to the low and high 64-bit values if users need
to convert to a native decimal128 type.</p>
<p>You can see how to work with <code>bsoncxx::decimal128</code> in <a href="https://github.com/mongodb/mongo-cxx-driver/blob/master/examples/bsoncxx/decimal128.cpp">this example</a>.</p>






<div id="btnv">
  
  <div class="pull-left">
  <a class="navigation prev" href="/mongocxx-v3/connection-pools/">
      <i class="fa fa-long-arrow-left"> </i> Connection pools
  </a>
  </div>
  
  
  <div class="pull-right">
  <a class="navigation next" href="/mongocxx-v3/api-abi-versioning/">
    API and ABI versioning <i class="fa fa-long-arrow-right"> </i>
  </a>
  
</div>
</div>


</div>
<div class="right-column">
<div class="wrapper">
  
  <div class="toc">
    <span class="toc-header">On this page</span>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#builders">Document Builders</a></li>
    <li><a href="#list">List builder</a></li>
    <li><a href="#one-off">&ldquo;One-off&rdquo; builder functions</a></li>
    <li><a href="#basic-builder">Basic builder</a></li>
    <li><a href="#stream-builder">Stream builder</a>
      <ul>
        <li><a href="#a-namevalueowning-bson-documents-valuesa"><!-- raw HTML omitted -->Owning BSON Documents (values)<!-- raw HTML omitted --></a></li>
        <li><a href="#a-nameviewnon-owning-bson-documents-viewsa"><!-- raw HTML omitted -->Non-owning BSON Documents (views)<!-- raw HTML omitted --></a></li>
        <li><a href="#a-nameview_or_valueoptionally-owning-bson-documents-view_or_valuea"><!-- raw HTML omitted -->Optionally-owning BSON Documents (view_or_value)<!-- raw HTML omitted --></a></li>
        <li><a href="#a-namelifetimebson-document-lifetimea"><!-- raw HTML omitted -->BSON Document Lifetime<!-- raw HTML omitted --></a></li>
        <li><a href="#a-nameprintprinting-bson-documentsa"><!-- raw HTML omitted -->Printing BSON Documents<!-- raw HTML omitted --></a></li>
        <li><a href="#a-namefieldsgetting-fields-out-of-bson-documentsa"><!-- raw HTML omitted -->Getting Fields out of BSON Documents<!-- raw HTML omitted --></a></li>
        <li><a href="#bson-types">BSON Types</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
  
</div>
</div>

</div>
</div>
</div>
</section>
</section>

</section>


<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
   URL_ROOT:    "https://mongocxx.org",
   VERSION:      null ,
   COLLAPSE_INDEX: false,
   FILE_SUFFIX: '.html',
   HAS_SOURCE:  true
  };
</script>
<script type="text/javascript" src="https://mongocxx.org/js/jquery.js"></script>
<script type="text/javascript" src="https://mongocxx.org/lib/bootstrap.js"></script>
<script type="text/javascript" src="https://mongocxx.org/js/navbar.js"></script>
<script type="text/javascript" src="https://mongocxx.org/lib/highlight/highlight.pack.js"></script>
<script type="text/javascript" src="https://mongocxx.org/js/scripts.js"></script>


<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-JQHP"
                 height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push(
  {'gtm.start': new Date().getTime(),event:'gtm.js'}
);var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-JQHP');</script>


<script type="text/javascript">
var _elqQ = _elqQ || [];
_elqQ.push(['elqSetSiteId', '413370795']);
_elqQ.push(['elqTrackPageView']);
(function () {
function async_load()
{ var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//img03.en25.com/i/elqCfg.min.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x); }
if (window.addEventListener) window.addEventListener('DOMContentLoaded', async_load, false);
else if (window.attachEvent) window.attachEvent('onload', async_load);
})();
</script>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-7301842-14"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-7301842-14');
</script>


<script type="text/javascript">
  !function(e,t,r,n,a){if(!e[a]){for(var i=e[a]=[],s=0;s<r.length;s++){var c=r[s];i[c]=i[c]||function(e){return function(){var t=Array.prototype.slice.call(arguments);i.push([e,t])}}(c)}i.SNIPPET_VERSION="1.0.1";var o=t.createElement("script");o.type="text/javascript",o.async=!0,o.src="https://d2yyd1h5u9mauk.cloudfront.net/integrations/web/v1/library/"+n+"/"+a+".js";var l=t.getElementsByTagName("script")[0];l.parentNode.insertBefore(o,l)}}(window,document,["survey","reset","config","init","set","get","event","identify","track","page","screen","group","alias"],"Dk30CC86ba0nATlK","delighted");

  delighted.survey();
</script>
</body>
</html>

